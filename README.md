
______________________________________________________________________

<div align="center">

# CATH Protein Language Model


</div>

## Description

training a MoE model on CATH/FunFams/TED/UniRef50
[(Docs)](https://docs.google.com/document/d/1UptsPFMFTVyTEu-Ve75NfNpVNrzrWPJlyWvfhi2nsw4/edit)



## Installation

#### Pip

```bash
# clone project
git clone https://github.com/alex-hh/profam.git
cd profam

# [OPTIONAL] create conda environment
conda create -n venvPF python=3.9
conda activate venvPF

# install requirements
pip install -r requirements.txt
```

## Loading environment on UCL cs cluster

```bash
source /SAN/orengolab/cath_plm/ProFam/pfenv.source
export PROFAM_DATA_DIR=/SAN/orengolab/cath_plm/ProFam/data
```

(The former file is at scripts/pfenv.source)

## How to run


Run on example data

```bash
python src/train.py logger=null_logger
```

Train model with default configuration

```bash
# train on CPU
python src/train.py trainer=cpu

# train on GPU
python src/train.py trainer=gpu
```

Train model with chosen experiment configuration from [configs/experiment/](configs/experiment/)

```bash
python src/train.py experiment=experiment_name.yaml
```

You can override any parameter from command line like this




```bash
python src/train.py trainer.max_epochs=20 data.batch_size=64
```

## Transition from `train_example.py` to Lightning Hydra Template

### Original `train_example.py` Script

The original script used the Hugging Face `Trainer` API to train a model on protein sequences. The key steps were:
1. Load and preprocess the interpro protein family datafiles.
2. Tokenize the protein sequences.
3. Define the model configuration.
4. Train the Mistral model using the `Trainer` class.

### New Setup with Lightning Hydra Template

The new setup uses PyTorch Lightning and Hydra for more modular and scalable training. Here are the key components:

1. **Data Module**: Handles data loading and preprocessing.
   - Defined in `src/data/protein_datamodule.py`.
   - Configuration in `configs/data/interpro.yaml`.

2. **Model Module**: Defines the model and training steps.
   - Defined in `src/models/mistral_lit_module.py`.
   - Configuration in `configs/model/mistral.yaml`.

3. **Training Script**: Orchestrates the training process.
   - Defined in `src/train.py`.
   - Main configuration in `configs/train.yaml`.


## Project Directory Structure
```
├── .github                   <- Github Actions workflows
│
├── configs                   <- Hydra configs
│   ├── callbacks                <- Callbacks configs
│   ├── data                     <- Data configs
│   ├── debug                    <- Debugging configs
│   ├── experiment               <- Experiment configs
│   ├── extras                   <- Extra utilities configs
│   ├── hparams_search           <- Hyperparameter search configs
│   ├── hydra                    <- Hydra configs
│   ├── local                    <- Local configs
│   ├── logger                   <- Logger configs
│   ├── model                    <- Model configs
│   ├── paths                    <- Project paths configs
│   ├── trainer                  <- Trainer configs
│   │
│   ├── eval.yaml             <- Main config for evaluation
│   └── train.yaml            <- Main config for training
│
├── data                   <- Project data
│
├── logs                   <- Logs generated by hydra and lightning loggers
│
├── notebooks              <- Jupyter notebooks.
│
├── scripts                <- Shell scripts
│
├── src                    <- Source code
│   ├── data                     <- Data scripts
│   ├── models                   <- Model scripts
│   ├── utils                    <- Utility scripts
│   │
│   ├── eval.py                  <- Run evaluation
│   └── train.py                 <- Run training
│
├── tests                  <- Tests of any kind
│
├── .gitignore                <- List of files ignored by git
├── .pre-commit-config.yaml   <- Configuration of pre-commit hooks for code formatting
├── .project-root             <- File for inferring the position of project root directory
├── environment.yaml          <- File for installing conda environment
├── pyproject.toml            <- Configuration options for testing and linting
├── requirements.txt          <- File for installing python dependencies
├── setup.py                  <- File for installing project as a package
└── README.md
```

<br>
